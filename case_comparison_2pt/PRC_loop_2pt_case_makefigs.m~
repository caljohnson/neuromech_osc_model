%PRC Loop
% The 2-Point Case study

clear
load('PRC_loop_2pt_case.mat');

%  Draw figs
for ccc = 1:size(c_MA,2)

    %set feedback strength according to loop
    c_MA = c_MAs(ccc);
    c = c_MA;
    
    %Save stuff for figures later
    z = vs(cc) = v;
    v = zs(cc) = v;
    t = ts(cc) = t;
    g1 = g1s(cc) = g1;
    h1p = h1ps(cc);
    ii = iis(cc);


% ----  II.  Draw Cycle ----  
figure(1); clf;
 xlim([0, ii*dt]);
subplot(4,1,1); plot(v(:,1),'Linewidth', 4); ylabel('\kappa');
subplot(4,1,2); plot(v(:,2), 'g','Linewidth', 4); hold on; plot(v(:,3), 'r','Linewidth', 4); 
ylabel('V'); legend('V', 'D');
subplot(4,1,3); plot(v(:,4), 'g','Linewidth', 4); hold on; plot(v(:,5), 'r','Linewidth', 4); 
ylabel('A'); legend('V', 'D');
subplot(4,1,4); plot(tanh(v(:,4)-2)+1, 'g','Linewidth', 4); hold on; plot(tanh(v(:,5)-2)+1, 'r','Linewidth', 4); 
ylabel('\sigma(A)'); legend('V', 'D');
suptitle('Cycle timetraces');
% OUTPUT:   v(1:ii,1:nv) contains periodic orbit
%           (ii-1)*dt=~period of orbit


% ----  II.  Draw iPRC ---- 

figure(2); clf; xlim([0, ii*dt]); suptitle('PRCs');
subplot(3,1,1); plot(z(:,1), 'Linewidth', 4); ylabel('\kappa');
subplot(3,1,2); plot(z(:,2), 'g', 'Linewidth', 4); hold on; plot(z(:,3), 'r','Linewidth', 4); 
ylabel('V'); legend('V', 'D');
subplot(3,1,3); plot(z(:,4), 'g','Linewidth', 4); hold on; plot(z(:,5), 'r','Linewidth', 4); 
ylabel('A'); legend('V', 'D');

% ---- III.  CALCULATE G-FUNCTION  ----
figure(3); clf;
plot(t(1:ii),g1,'r', 'linewidth',2); hold on; 
plot(t(1:ii),h1p,'g', 'linewidth',2);
plot([0,p],[0,0],'k:','linewidth',2);
plot(t(Indsg1(1:3)),0*Indsg1(1:3),'ko','Markersize',10);
plot(t(Indsh1p(1:2)),0*Indsh1p(1:2),'ko','Markersize',10);
legend('mechanical','proprioceptive','"zero"');
xlabel('time(ms)'); 
title('G-function for NM paired-oscillator model');

end

save('PRC_loop_2pt_case');
